Import("synth_env soc_v")

log = File("yosys.log")
blif = File("Soc.blif")
yosys_env = Environment(YOSYS_LOG = log, BLIF = blif)
yosys_env.Command(
    [blif, log],
    soc_v,
    'yosys -p "synth_ice40 -blif $BLIF" $SOURCE > $YOSYS_LOG'
)

yosys_env['PCF'] = File("Soc.pcf")
yosys_env['TXT'] = File("Soc.txt")

yosys_env.Command(
    yosys_env['TXT'],
    [yosys_env['BLIF'], yosys_env['PCF']],
    "arachne-pnr --device 1k --pcf-file $PCF $BLIF -o $TXT"
)
