Import('CLASSPATH')

scala_sources = Glob('main/scala/*') + Glob('test/scala/*')

env = Environment()
classes = env.Command(
    '#build/scala/classes/TurboRav/TurboRav.class',
    """fsc\
    {0}\
    -classpath {1}\
    -d build/scala/classes\
    build/main/scala/*.scala\
    build/test/scala/*.scala""".format(
        SCALAFLAGS,
        CLASSPATH
    )
)

turborav_jar = Jar(
    target = '#build/scala/turborav.jar',
    source = Glob('#build/scala/classes/TurboRav/*')
)

lint_env = Environment()
lint_env['config_file'] = "src/scalastyle_config.xml"
lint_env.Command(
    '#build/test/lint/main.txt',
    scala_sources,
    """scalastyle --config $config_file src/main/scala > $TARGET && \
       scalastyle --config $config_file src/test/scala >> $TARGET
    """
)

Return('turborav_jar')
